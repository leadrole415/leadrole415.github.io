
<!DOCTYPE HTML>
<html>
	<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<title>다락골 초록원</title>
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<meta name="description" content="" />
	<meta name="keywords" content="" />
	<meta name="author" content="" />

  <!-- Facebook and Twitter integration -->
	<meta property="og:title" content=""/>
	<meta property="og:image" content=""/>
	<meta property="og:url" content=""/>
	<meta property="og:site_name" content=""/>
	<meta property="og:description" content=""/>
	<meta name="twitter:title" content="" />
	<meta name="twitter:image" content="" />
	<meta name="twitter:url" content="" />
	<meta name="twitter:card" content="" />

	<link href="https://fonts.googleapis.com/css?family=Poppins:300,400,500,700" rel="stylesheet">
	<link href="https://fonts.googleapis.com/css?family=Playfair+Display:400,700" rel="stylesheet">
	
	<!-- Animate.css -->
	<link rel="stylesheet" href="css/animate.css">
	<!-- Icomoon Icon Fonts-->
	<link rel="stylesheet" href="css/icomoon.css">
	<!-- Bootstrap  -->
	<link rel="stylesheet" href="css/bootstrap.css">

	<!-- Magnific Popup -->
	<link rel="stylesheet" href="css/magnific-popup.css">

	<!-- Flexslider  -->
	<link rel="stylesheet" href="css/flexslider.css">

	<!-- Owl Carousel -->
	<link rel="stylesheet" href="css/owl.carousel.min.css">
	<link rel="stylesheet" href="css/owl.theme.default.min.css">
	
	<!-- Date Picker -->
	<!--jQuery UI CSS파일-->
	<link rel="stylesheet" href="http://code.jquery.com/ui/1.9.2/themes/base/jquery-ui.css" type="text/css" />
	<!-- Flaticons  -->
	<link rel="stylesheet" href="fonts/flaticon/font/flaticon.css">

	<!-- Theme style  -->
	<link rel="stylesheet" href="css/style.css">


	<!-- Modernizr JS -->
	<script src="js/modernizr-2.6.2.min.js"></script>

		 <style>
		.main-text{
			width:100%;
			margin:0 auto;
		}   

        body {
            margin: 0;
            padding: 0;
        }
        table{
			border-collapse: collapse;
			width:100%;
			max-width: 100%;
		}
		
		.input_style input{
			border-style:none;
		}
		
		h4{
			text-align:left;
		}
        #wrap {
			padding-top: 100px;
			clear:both;
            width: 1170px;
            /* margin: 20px auto; */
        }

        #rHeader {
            /* margin-top: 30px; */
        }

        #rTopmenu {
            list-style: none;
            /* padding-top: 100px; */
        }

        #rList {
            height: 31px;
            padding: 0px;
            margin: 0px;
            border-bottom: 1px solid silver;
        }

        #rTopmenu li {
            display: inline;
        }
       
        #rTopmenu li a{
            background: rgb(255, 255, 255);
            border-bottom: 1px solid rgb(255, 255, 255);
            text-decoration: none;
            position: relative;
            float: left;
            width: 130px;
            height: 30px;
            line-height: 30px;
            text-align: center;
            font-size: 14px;
            /* color: grey; */
            margin: 0px -1px -1px 0px;
            border-width: 1px;
            border-style: solid;
            border-color: rgb(210, 210, 210);
		}
		
		@media screen and (max-width: 480px) {
			#rTopmenu li a {
				width:80px;
			} 
		}
        
		#myForm {
            padding-top: 30px;
            clear: both;
        }

        tr,
        td {
            padding: 10px 15px;
        }

        .red {
            color: red;
        }

        .green {
            color: green;
            font-size: 0.8em;
        }

        .right {
            font-size: 0.8em;
            text-align: right;
        }

        textarea {
            width: 99%;
            border: 1px solid silver;
        }

        #submit {
            margin: 30px 0;
            text-align: center;
				}
	</style>
	</head>
	<body>
	<div class="colorlib-loader"></div>

	

<div id="page">
	<nav class="colorlib-nav" role="navigation">
		<div class="top-menu">
			<div class="container">
				<div class="row">
					<div class="col-xs-2">
						<div id="colorlib-logo"><a href="index.php"><img src="images/logo.png" width="80px" alt=""></a></div>
					</div>
					<div class="col-xs-10 text-right menu-1">
						<ul>
							<li><a href="index.php">Home</a></li>
							<li><a href="rooms.php">Rooms</a></li>
							<li><a href="do.html">Do</a></li>
							<li><a href="tour.php">Tour</a></li>
							<li><a href="info.html">Info</a></li> 
							<li class="active"><a href="#">Reservation</a></li>
							<li><a href="notice.php">Notice</a></li>
						</ul>
					</div>
				</div>
			</div>
		</div>
	</nav>	

		<aside id="colorlib-hero">
			<div class="flexslider">
				<ul class="slides">
			   	<li style="background-image:url(images/01_01.jpg);">
			   		<div class="overlay"></div>
			   		<div class="container-fluid">
			   			<div class="row">
				   			<div class="col-md-6 col-sm-12 col-md-offset-3 slider-text main-text">
				   				<div class="slider-text-inner slider-text-inner2 text-center">
								   <h2>Awesome days !!!</h2>
				   					<h1>Reservation</h1>
				   				</div>
				   			</div>
				   		</div>
			   		</div>
			   	</li>
			  	</ul>
		  	</div>
		</aside>
	

		<div width=100%>	
	    <center>
			<div id="wrap" width=100%>
            <div id="rTopmenu" width=100%>
                <ul id="rList">
					<li>
                        <a href="reservation_guide.php" style="color:grey">예약안내</a>
                    </li>
                    <li>
                        <a href="reservation_status.php" style="color:grey">예약현황</a>
                    </li>
                    <li>
                        <a href="reservation.php" style="color:#fff; background-color:#F96D00;">예약하기</a>
                    </li>
                    <li>
                        <a href="reservation_check.php" style="color:grey">예약확인</a>
                    </li>
                </ul>
            </div>
			</div>	
	
		<div id="colorlib-testimony">
			<div class="container">
				<div class="row">

<?
		$date_today  = date('Y-m-d');

		$date_from   = isset($_REQUEST['date_from']) ? $_REQUEST['date_from'] : date("Y-m-d");
		$date_to     = isset($_REQUEST['date_to']) ? $_REQUEST['date_to'] : $date_from;
		$sroomid		 = $_REQUEST['room_id'];
		$speople      = isset($_REQUEST['people']) ? $_REQUEST['people'] : "2";
		$ssumprice    = isset($_REQUEST['sum_price']) ? $_REQUEST['sum_price'] : "";
		$soptionid    = isset($_REQUEST['option_id']) ? $_REQUEST['option_id'] : "";
		$book_totalprice = isset($_REQUEST['total_price']) ? $_REQUEST['total_price'] : "";

		$book_name = isset($_REQUEST['name']) ? $_REQUEST['name'] : $_REQUEST['name'];
		$book_account = isset($_REQUEST['name_account']) ? $_REQUEST['name_account'] : $book_name;
		$book_birth = $_REQUEST['birthday'];
		$book_mobile = $_REQUEST['phone1']."-".$_REQUEST['phone2']."-".$_REQUEST['phone3'];
		$book_comment = htmlspecialchars($_REQUEST['comment']);
		$book_name = htmlspecialchars($book_name);
		$book_account = htmlspecialchars($book_account);
		$room_id = explode(",",$sroomid);
		$roomcnt = count($room_id);
		$people = explode(",",$speople);
		$sum_price = explode(",",$ssumprice);
		$option_id = explode(",",$soptionid);
		$optioncnt = count($option_id);
		// echo $soptionid.':'.$optioncnt;
		// var_dump($option_id);

		$sendget = "?date_from=$date_from";
		$sendget .= "&date_to=$date_to";
		$sendget .= "&room_id=$sroomid";
		$sendget .= "&eople=$speople";
		// $sendget .= "&option_id=$soptionid";

		// echo $sendget;

		$diff  = strtotime($date_to) - strtotime($date_from);
		$years = floor($diff / (365*60*60*24));
		$months = floor(($diff - $years * 365*60*60*24) / (30*60*60*24));
		$days  = floor(($diff - $years * 365*60*60*24 - $months*30*60*60*24)/ (60*60*24));
		$daynums = $days."박 ".($days+1)."일";
		if($diff==0){
?>
			<script> 
				alert('날짜를 확인하세요. 0박 1일을 선택하였습니다.');
				location.href="reservation.php<?=$sendget?>"; 
			</script>
<?		} ?>
<?
		include "zdb_mysqli.php";
		$conn = dbconn();

		$query = "select count(*) from room";
		$result = dbquery($conn,$query);
		$row = dbfetch_array($result);
		$roomlength = $row[0];

	$query = "select * from reservation 
		where book_datefrom < '$date_to'  
		and  book_dateto > '$date_from'";
		$result = dbquery($conn,$query);
		// $rowcount=mysqli_num_rows($result);
		// if($rowcount > 0){
			$isdbflag=0;
			while($row = dbfetch_array($result)){
				for($j=0; $j<$roomcnt; $j++){
					if($room_id[$j] == $row['room_id']){
						$isdbflag=1;
						break;
					}
				}
			}	
		// }
		if($isdbflag==1){
			// echo $sendget;
?>
			<script> 
				alert('예약이 중복됩니다. 예약내용을 다시 확인하세요.');
				location.href="reservation.php<?=$sendget?>"; 
			</script>
<?	
		}
?>

				<table class="table text-right;" id="tblRoom" bored="1">
				<caption><h4>선택객실목록</h4></caption>	
					<tr><b>
						<td>객실명</td>
						<td>CHECK_IN</td>
						<td>CHECK OUT</td>
						<td>이용인원</td>
						<td>이용일수</td>
						<td colspan="2" style="text-align: center; ">적용일</td>
						<td style="text-align: right; ">적용요금</td>
					</b></tr>
<?

		$wday=$wend=$wpeak=0; 
		$dayfrom = $date_from;
		$peakfrom = "2018-07-15";   //성수기시작일
		$peakto = "2018-08-15";		//성수기시작일

		for($i=0; $i<$days; $i++){
			$week = date("w",strtotime("$dayfrom"));
			if($dayfrom>=$peakfrom && $dayfrom<=$peakto) $wpeak++;
			else{
				if($week==5 || $week==6) $wend++;
				else $wday++;
			}
			$dayfrom = date("Y-m-d", strtotime($dayfrom."+1day"));
		}

		// 룸에 대한정보
		$total_price = 0;
		for($i=0; $i<$roomcnt; $i++)
		{
			$roomid = $room_id[$i];
			$query = "select * from room where room_id='$roomid'";
			$result = dbquery($conn,$query);
			$row = dbfetch_array($result);
			$room_name = $row['room_name']; 
			$room_price1 = $row['room_price']; //주중
			$room_price2 = $row['room_price1']; //주말
			$room_price3 = $row['room_price2']; //성수기 = 주말
			$sum_pr1 = $room_price1 * $wday;
			$sum_pr2 = $room_price2 * $wend;
			$sum_pr3 = $room_price3 * $wpeak;
			$sum_price[$i] = $sum_pr1 + $sum_pr2 + $sum_pr3;
			$total_price += $sum_price[$i];
?>					
				<tr>
				<td><?= $room_name ?></td>
					<td><?= $date_from ?></td>
					<td><?= $date_to ?></td>
					<td><?= $people[$i] ?> 명</td>
					<td><?= $daynums ?></td>
					<td>주중<br>
						주말<br>
					    성수기</td>
					<td style="text-align: right; "><?= $wday ?> 일<br>
						<?= $wend ?> 일<br>
					    <?= $wpeak ?> 일</td>
						<td style="text-align: right; ">
						<?= number_format($sum_pr1) ?> 원<br>
						<?= number_format($sum_pr2) ?> 원<br>
						<?= number_format($sum_pr3) ?> 원</td>
				</tr>
<?		}?>				
				<tr>
					<th colspan="8">부대시설 이용옵션</th>
				</tr>
<?
		if($optioncnt!=0){
			$book_fire=$book_camp=0;
			for($i=0; $i<$optioncnt; $i++){
				$query = "select * from roomoption where option_id = '$option_id[$i]' ";
				$result = dbquery($conn,$query);
				$row = dbfetch_array($result);
				$option_id[$i] = $row['option_id'];
				$option_name[$i] = $row['option_name'];
				$option_price[$i] = $row['option_price']; 
				$option_num[$i] = $row['option_num']; 
				if($row['option_id']==1) $book_camp=1;
				if($row['option_id']==2) $book_fire=1;
				$optsum_price[$i]=  $option_price[$i];
				$total_price += $optsum_price[$i];
	?>	
				<tr>
					<td colspan="6"><?=$option_name[$i]?></td>
					<td style="text-align: right; "><?=number_format($option_price[$i]) ?> 원	</td>
					<td style="text-align: right; "><?=number_format($optsum_price[$i]) ?> 원	</td>
				</tr>
<?  		} //for($i=0; $i<$optioncnt; $i++) ?>
					
<?  	} //if($optioncnt!=0) ?>					
				<tr>
					<td colspan="7" >총 금 액</td>
					<td style="text-align: right; "><?=number_format($total_price) ?> 원	</td>
				</tr>
			</table>



			<!-- <form action="" method="POST" id="myForm"> -->

                <table class="table" id="tblRoom" bored="1">
					<caption><h4>예약자 정보</h4></caption>
                    <tr>
                        <td>예약자명</td>
                        <td>생년월일</td>
                        <td>연락처</td>
                    </tr>
                    <tr>
                        <td><?=$book_name?></td>
                        <td><?=$book_birth?></td>
                        <td><?=$book_mobile?></td>
                    </tr>
                    <tr>
                        <td>예약요청사항</td>
                        <td colspan="2"><textarea style="width:100%;border:1;text-overflow:ellipsis;" rows=3 readonly><?=$book_comment?></textarea></td>
                    </tr>
                </table>
				</div>
				<div class="row">
				</div>
<?				

	if(!$isdbflag){
		for($i=0,$savefail=0; $i<$roomcnt; $i++){

			// $query = "SELECT room_id FROM room WHERE '$room_name[$i]'";
			// $result = dbquery($conn,$query);
			// $row=dbfetch_array($result);
			// $room_id = $row['room_id'];
			// echo $room_id;

			$query = "INSERT  INTO `reservation`(
				`book_rdate`,`book_datefrom`,`book_dateto`,
				`room_id`,`book_person`,`book_name`,`book_mobile`,
				`book_account`,`book_birth`,`book_fire`,`book_camp`,
				`book_comment`,`book_status`,`book_totalprice`)
				VALUES (
				NOW(),'$date_from','$date_to',
				'$room_id[$i]',$people[$i],'$book_name','$book_mobile',
				'$book_account','$book_birth',$book_camp,$book_fire,
				'$book_comment',0,$sum_price[$i]
				) ";

			$result = dbquery($conn,$query);
			if(!$result){
				$savefail++;
				break;
			}
		}
	}
	?>	<div>
<?
			if($savefail==0){
?>				
				<p style="font-size:130%";>
				예약내용을 등록하였습니다. 
				</p>
				<p style="color:red; font-size:140%";>
				24시간이내에 입금하지 않으면 자동 취소됩니다.
				</p>
				<p style="font-size:130%";>
				계좌번호 : 농협 0108772-831709 (예금주:신옥연)</font></p>
<?			
			}
			else{
?>	
				<p><font color="red">저장에 실패하였습니다. 관리자에게 문의하세요...</font></p>
<?			}?>

        <a href='index.php'><button  class="btn btn-primary">Home</button></a> &nbsp;&nbsp;
        <a href='reservation.php<?=$sendget?>'><button  class="btn btn-primary">예약하기</button></a> &nbsp;&nbsp;
        <a href="reservation_status.php"><button class="btn btn-primary">예약현황</button></a> &nbsp;&nbsp;


		</div>
			</div>
				<div class="row">
				</div>
				
			</div>

		</div>
		</center>
	</div>	


		<footer id="colorlib-footer" role="contentinfo">
			<div class="container">
				<div class="row row-pb-md">
					<div class="col-md-3 colorlib-widget">
						<h4>다락골 초록원</h4>
						<!-- <p>Facilis ipsum reprehenderit nemo molestias. Aut cum mollitia reprehenderit. Eos cumque dicta adipisci architecto culpa amet.</p> -->
						<!-- <p>
							<ul class="colorlib-social-icons">
								<li><a href="#"><i class="icon-twitter"></i></a></li>
								<li><a href="#"><i class="icon-facebook"></i></a></li>
								<li><a href="#"><i class="icon-linkedin"></i></a></li>
								<li><a href="#"><i class="icon-dribbble"></i></a></li>
							</ul>
						</p> -->
					</div>
					<div class="col-md-3 colorlib-widget">
						<!-- <h4>Quick Links</h4> -->
						<p>
							<ul class="colorlib-footer-links">
								<!-- <li><a href="#">Accomodation</a></li>
								<li><a href="#">Dining &amp; Bar</a></li>
								<li><a href="#">Restaurants</a></li>
								<li><a href="#">Beach &amp; Resorts</a></li>-->
							</ul>
						</p>
					</div>
					<div class="col-md-3">
						<!-- <h4>Recents Blog Post</h4> -->
						<ul class="colorlib-footer-links">
						<li>주소 : 경북 문경시 농암면 서재로 703번지</li>
						<li>TEL : 054.571.8388</a></li>
							<!-- <li><a href="#">A Definitive Guide to the Best Dining and Drinking Venues in the City</a></li> -->
						</ul>
					</div> 

					<div class="col-md-3 col-md-push-1">
						<!-- <h4>Contact Information</h4> -->
						<ul class="colorlib-footer-links">
							<li><a href="mailto:jsg1039@naver.com">jsg1039@naver.com</a></li>
							<li><a href="./darakgol_admin/admin_index.html">관리자 로그인</a></li>
						</ul>
					</div>
				</div>
				<div class="row">
					<div class="col-md-12 text-center">
						<p>
							<small class="block"><!-- Link back to Colorlib can't be removed. Template is licensed under CC BY 3.0. -->
							Copyright &copy;<script>document.write(new Date().getFullYear());</script> All rights reserved | Back-end &#38; front-end 1조(김재연,김주연,박선미,박영주,신재순,장미경)
						</p>
					</div>
				</div>
			</div>
		</footer>
	</div>

	<div class="gototop js-top">
		<a href="#" class="js-gotop"><i class="icon-arrow-up2"></i></a>
	</div>
	</body>

	 <!-- jQuery 기본 js파일-->
	 <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
	 <!-- jQuery UI 라이브러리 js파일-->
	 <script src="http://code.jquery.com/ui/1.9.2/jquery-ui.min.js"></script>
	<script>
		$( function() {
			$.datepicker.regional['ko'] = {
			closeText: '닫기',
			prevText: '이전달',
			nextText: '다음달',
			currentText: '오늘',
			monthNames: ['1월(JAN)','2월(FEB)','3월(MAR)','4월(APR)','5월(MAY)','6월(JUN)',
			'7월(JUL)','8월(AUG)','9월(SEP)','10월(OCT)','11월(NOV)','12월(DEC)'],
			monthNamesShort: ['1월','2월','3월','4월','5월','6월',
			'7월','8월','9월','10월','11월','12월'],
			dayNames: ['일','월','화','수','목','금','토'],
			dayNamesShort: ['일','월','화','수','목','금','토'],
			dayNamesMin: ['일','월','화','수','목','금','토'],
			weekHeader: 'Wk',
			dateFormat: 'yy-mm-dd',
			firstDay: 0,
			isRTL: false,
			showMonthAfterYear: true,
			yearSuffix: '',
			// showOn: 'both',
			minDate: 0,
			// buttonText: "달력",
			changeMonth: true,
			// changeYear: true,
			showButtonPanel: true,
			yearRange: 'c-1:c+2',
			};
			$.datepicker.setDefaults($.datepicker.regional['ko']);
		
			$("#date_from").val('<?= $date_from?>');	
			$("#date_to").val('<?= $date_to?>');	
			
					$( "#date_from" ).datepicker({
						onClose: function(selectedDate){
							$('#date_to').datepicker("option", "minDate", selectedDate);
						},
						onSelect: function(dateText,inst){
						  	$("#date_to").val(dateText);
						  }
					});
					$( "#date_to" ).datepicker({
						onSelect: function(dateText,inst){
						}
					});

		} );
			


	function CheckValue() {

		if (
			GetCheckBoxCheckedValues('chk') == ""
			&&
			GetCheckBoxCheckedValues('option') == ""

		) {
			alert("예약 할 객실 또는 부대시설옵션을 선택하세요.");
			return false;
		}

		//객실 예약없이 이용옵션만 선택하였음
		if (
			GetCheckBoxCheckedValues('chk') == ""
			&&
			GetCheckBoxCheckedValues('option') != ""
		) {
			return confirm("객실을 선택하지 않으셨습니다.");
		}


		if ($("#date_from").text() == $("#date_to").text()) {
			return confirm("출발일과 도착일이 같습니다. 다시 한번 확인하세요.");
		}
	}
	</script>



	<!-- jQuery Easing -->
	<script src="js/jquery.easing.1.3.js"></script>
	<!-- Bootstrap -->
	<script src="js/bootstrap.min.js"></script>
	<!-- Waypoints -->
	<script src="js/jquery.waypoints.min.js"></script>
	<!-- Flexslider -->
	<script src="js/jquery.flexslider-min.js"></script>
	<!-- Owl carousel -->
	<script src="js/owl.carousel.min.js"></script>
	<!-- Magnific Popup -->
	<script src="js/jquery.magnific-popup.min.js"></script>
	<script src="js/magnific-popup-options.js"></script>
	<!-- Date Picker -->
	<!-- <script src="js/bootstrap-datepicker.js"></script> -->
	<!-- Main -->
	<script src="js/main.js"></script>
</html>

	

